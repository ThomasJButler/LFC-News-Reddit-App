/* WHY: Staggered entry animation for top-level comments creates visual hierarchy
   - 200ms duration (lighter than posts per spec)
   - Fade only (no slide) for subtler effect
   - 30ms stagger between items
   - CSS custom property --animation-order allows dynamic delay calculation */
@keyframes commentEnter {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Wrapper for comment list with actions header */
.commentListWrapper {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

/* Actions bar at top of comments (Collapse All / Expand All button) */
.commentActions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-md);
  gap: var(--spacing-md);
}

.collapseAllButton {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  background: var(--accent-ultra-light);
  border: 1px solid var(--accent-light);
  color: var(--accent);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--radius-md);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  /* WHY: WCAG 2.5.5 - 44x44px minimum touch target */
  min-height: 44px;
  /* WHY: Use theme transition for color changes, fast for transform */
  transition: background-color var(--transition-theme),
              color var(--transition-theme),
              border-color var(--transition-theme),
              transform var(--transition-fast);
}

.collapseAllButton:hover {
  background: var(--accent-light);
  color: var(--theme-accent);
  border-color: var(--accent);
  transform: translateY(-2px);
}

.collapseAllButton:active {
  /* WHY: scale(0.97) provides tactile press feedback per animation-refinements.md spec */
  transform: translateY(0) scale(0.97);
}

.commentCount {
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
  font-weight: var(--font-weight-medium);
}

.commentList {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

/* Top-level comment wrapper with enhanced visual separation */
/* WHY: Clear visual separation helps users distinguish between different conversation threads */
.topLevelComment {
  padding-bottom: var(--spacing-md);
  margin-bottom: var(--spacing-md);
  border-bottom: 2px solid var(--glass-border);
}

/* WHY: Staggered entry animation for top-level comments
   30ms stagger between items (per spec), up to 15 items (450ms max delay) */
.topLevelCommentAnimated {
  animation: commentEnter 200ms cubic-bezier(0.4, 0, 0.2, 1) backwards;
  animation-delay: calc(var(--animation-order, 0) * 30ms);
}

.topLevelComment:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

/* Container for virtualized comment list (when > 20 comments) */
/* WHY: Position relative and overflow hidden prevent deeply nested comments from visually overlapping on mobile */
.commentListContainer {
  width: 100%;
  position: relative;
  overflow: hidden;
  /* Height set dynamically by VariableSizeList */
}

.comment {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-md);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-sm);
  /* WHY: Use theme transition for color/background changes, fast for transform */
  transition: background-color var(--transition-theme),
              border-color var(--transition-theme),
              transform var(--transition-fast),
              box-shadow var(--transition-fast);
  position: relative;
  box-shadow: var(--shadow-sm);
}

/* Alternating background tints for depth clarity */
/* WHY: Helps users visually track which level they're reading at in deeply nested threads */
.commentOddDepth {
  background: var(--bg-secondary);
}

/* Vertical thread line (colored by depth) */
/* WHY: Reddit-style thread lines help users follow conversation branches */
.comment::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--thread-color, var(--accent));
  border-radius: var(--radius-sm);
  opacity: 0.6;
  transition: opacity var(--transition-fast),
              box-shadow var(--transition-fast);
}

/* WHY: Clickable thread line button per comment-threading-polish.md spec
   Overlays the visual thread line to allow collapse on click
   Negative tabIndex since collapse button already provides keyboard access */
.threadLineButton {
  position: absolute;
  left: -4px;
  top: 0;
  bottom: 0;
  width: 11px;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 0;
  z-index: 1;
}

/* WHY: Hover glow effect on thread line per comment-threading-polish.md spec
   Applied when hovering the thread line button area */
.threadLineButton:hover::before {
  content: '';
  position: absolute;
  left: 4px;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--thread-color, var(--accent));
  border-radius: var(--radius-sm);
  opacity: 1;
  box-shadow: 0 0 8px var(--thread-color, var(--accent));
}

.comment:hover {
  background: var(--accent-ultra-light);
  border-color: var(--accent-light);
  transform: translateX(2px);
  box-shadow: var(--shadow-md);
}

.comment:hover::before {
  opacity: 1;
}

.commentHeader {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-sm);
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
  flex-wrap: wrap;
}

.collapseButton {
  background: var(--accent-ultra-light);
  border: 1px solid var(--accent-light);
  color: var(--accent);
  cursor: pointer;
  padding: var(--spacing-xs);
  /* Updated: Minimum 44x44px touch target for accessibility (WCAG 2.5.5) */
  min-width: 44px;
  min-height: 44px;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size-sm);
  border-radius: var(--radius-full);
  /* WHY: Use theme transition for color changes, fast for transform */
  transition: background-color var(--transition-theme),
              color var(--transition-theme),
              transform var(--transition-fast),
              box-shadow var(--transition-fast);
  font-weight: var(--font-weight-bold);
}

.collapseButton:hover {
  background: var(--accent-light);
  color: var(--theme-accent);
  transform: scale(1.1);
  box-shadow: var(--shadow-sm);
}

.collapseButton:active {
  /* WHY: scale(0.97) provides tactile press feedback per animation-refinements.md spec */
  transform: scale(0.97);
}

/* WHY: Chevron rotation animation for collapse/expand per animation-refinements.md spec
   Smooth 200ms rotation instead of icon swap provides better visual feedback */
.chevronIcon {
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 200ms ease-out;
}

.collapseButton.collapsed .chevronIcon {
  transform: rotate(-90deg);
}

/* Reply count badge on collapse button */
/* WHY: Shows users how many replies are hidden when a thread is collapsed */
.replyCount {
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-bold);
  margin-left: 4px;
  color: inherit;
}

/* Avatar styling in comment header */
/* WHY: Avatar placed before username following social media conventions */
.commentAvatar {
  flex-shrink: 0;
}

.author {
  font-weight: 500;
  color: var(--text-primary);
}

.author.op {
  color: var(--accent);
}

.opBadge {
  background-color: var(--accent);
  color: white;
  padding: 1px 4px;
  border-radius: var(--radius-sm);
  /* WHY: Using --font-size-xs for consistency (0.625rem -> 0.75rem) */
  font-size: var(--font-size-xs);
  margin-left: var(--spacing-xs);
  font-weight: 600;
}

.score::before,
.time::before {
  content: "â€¢";
  margin-right: var(--spacing-xs);
  color: var(--text-muted);
}

.stickied,
.distinguished {
  padding: 2px 6px;
  border-radius: var(--radius-sm);
  font-size: var(--font-size-xs);
  font-weight: 500;
}

.stickied {
  background-color: var(--lfc-green);
  color: white;
}

.distinguished {
  background-color: var(--accent);
  color: white;
}

/* WHY: Moderator badge per comment-threading-polish.md spec
   Green pill style for moderator-distinguished comments */
.modBadge {
  background-color: var(--lfc-green);
  color: white;
  padding: 1px 6px;
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-bold);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.commentBody {
  color: var(--text-primary);
  line-height: 1.5;
  margin-bottom: var(--spacing-sm);
  word-wrap: break-word;
  word-break: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  /* Enforce maximum line length for readability (65-75 characters) */
  max-width: 75ch;
  /* WHY: Animated collapse per comment-threading-polish.md spec (300ms ease-out)
     Using max-height transition allows smooth height animation */
  overflow: hidden;
  transition: max-height 300ms ease-out,
              opacity 200ms ease-out;
  max-height: 2000px;
  opacity: 1;
}

/* WHY: Collapsed state uses muted styling and animates to zero height */
.commentBodyCollapsed {
  max-height: 0;
  opacity: 0;
  margin-bottom: 0;
}

.commentBody p {
  margin-bottom: var(--spacing-sm);
}

.commentBody p:last-child {
  margin-bottom: 0;
}

.commentBody a {
  color: var(--accent);
  text-decoration: none;
}

.commentBody a:hover {
  text-decoration: underline;
}

.commentBody code {
  background-color: var(--bg-secondary);
  padding: 2px 4px;
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  font-size: var(--font-size-sm);
}

.commentBody pre {
  background-color: var(--bg-secondary);
  padding: var(--spacing-sm);
  border-radius: var(--radius-sm);
  overflow-x: auto;
  margin: var(--spacing-sm) 0;
}

.commentBody blockquote {
  border-left: 3px solid var(--accent);
  padding-left: var(--spacing-md);
  margin: var(--spacing-sm) 0;
  color: var(--text-secondary);
}

.replies {
  margin-top: var(--spacing-sm);
}

/* WHY: Action bar per comment-threading-polish.md spec
   Pill-style buttons with icons, visible on hover (desktop) or always (mobile) */
.actionBar {
  display: flex;
  gap: var(--spacing-sm);
  margin-top: var(--spacing-sm);
  opacity: 0;
  transition: opacity var(--transition-fast);
}

/* Show action bar on comment hover (desktop) */
.comment:hover .actionBar {
  opacity: 1;
}

.actionButton {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: var(--accent-ultra-light);
  border: 1px solid var(--accent-light);
  border-radius: var(--radius-full);
  color: var(--accent);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  text-decoration: none;
  transition: background-color var(--transition-fast),
              color var(--transition-fast),
              transform var(--transition-fast);
}

.actionButton:hover {
  background: var(--accent-light);
  color: var(--theme-accent);
  transform: translateY(-1px);
}

.actionButton:active {
  transform: scale(0.97);
}

.actionButtonCopied {
  background: var(--lfc-green);
  border-color: var(--lfc-green);
  color: white;
}

.gifContainer {
  margin: var(--spacing-sm) 0;
  border-radius: var(--radius-md);
  overflow: hidden;
  background: var(--bg-secondary);
  max-width: 300px;
}

.commentGif {
  width: 100%;
  height: auto;
  display: block;
  border-radius: var(--radius-md);
  transition: transform var(--transition-fast);
}

.commentGif:hover {
  transform: scale(1.02);
}

.commentImage {
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-sm);
  margin: var(--spacing-sm) 0;
}

.noComments {
  text-align: center;
  padding: var(--spacing-xl);
  color: var(--text-secondary);
  font-style: italic;
}

/* Media content styles */
.gifContainer,
.videoContainer,
.videoLinkContainer,
.imageLinkContainer {
  margin: var(--spacing-sm) 0;
  border-radius: var(--radius-md);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}

.commentImage,
.commentGif {
  max-width: 100%;
  height: auto;
  display: block;
  border-radius: var(--radius-md);
  transition: transform var(--transition-fast);
}

.commentImage:hover,
.commentGif:hover {
  transform: scale(1.02);
}

.commentVideo {
  width: 100%;
  max-width: 500px;
  height: auto;
  border-radius: var(--radius-md);
  background: var(--bg-secondary);
}

.videoContainer,
.videoLinkContainer {
  background: var(--bg-secondary);
  padding: var(--spacing-xs);
}

.gifContainer {
  background: var(--bg-secondary);
  max-width: 400px;
}

/* Responsive media queries */
@media (max-width: 767px) {
  .commentActions {
    padding: var(--spacing-sm);
    gap: var(--spacing-sm);
    /* Disable backdrop-filter on mobile for performance (GPU-intensive) */
    backdrop-filter: none;
  }

  .collapseAllButton {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: var(--font-size-xs);
  }

  .commentCount {
    font-size: var(--font-size-xs);
  }

  .topLevelComment {
    padding-bottom: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
  }

  .comment {
    padding: var(--spacing-sm);
    margin-bottom: var(--spacing-xs);
    /* Disable backdrop-filter on mobile for performance (GPU-intensive) */
    backdrop-filter: none;
    background: var(--bg-secondary);
  }

  .commentBody {
    /* WHY: Using --font-size-sm for consistency (0.9rem -> 0.875rem) */
    font-size: var(--font-size-sm);
    overflow-x: hidden;
  }

  .commentBody p {
    max-width: 100%;
    overflow-wrap: break-word;
  }

  .commentBody pre {
    max-width: 100%;
    overflow-x: auto;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .commentBody blockquote {
    padding-left: var(--spacing-sm);
    margin: var(--spacing-xs) 0;
  }

  .commentHeader {
    /* WHY: Using --font-size-sm for consistency (0.8rem -> 0.875rem) */
    font-size: var(--font-size-sm);
    gap: var(--spacing-xs);
  }

  .replies {
    padding-left: var(--spacing-xs);
  }

  .commentImage,
  .commentGif,
  .commentVideo {
    max-width: 100%;
    border-radius: var(--radius-sm);
  }
  
  .gifContainer,
  .videoContainer,
  .videoLinkContainer,
  .imageLinkContainer {
    margin: var(--spacing-xs) 0;
  }
  
  .gifContainer {
    max-width: 100%;
  }

  /* WHY: Action bar always visible on mobile per comment-threading-polish.md spec
     No hover on touch devices, so buttons must be visible */
  .actionBar {
    opacity: 1;
  }

  /* WHY: Ensure 44x44px touch targets for WCAG 2.5.5 accessibility */
  .actionButton {
    min-height: 44px;
    padding: var(--spacing-sm) var(--spacing-md);
  }
}

/* WHY: Respect user's motion preferences for accessibility (WCAG 2.3.3)
   Users with vestibular disorders may experience discomfort from animations */
@media (prefers-reduced-motion: reduce) {
  .topLevelCommentAnimated {
    animation: none;
    opacity: 1;
  }

  .chevronIcon {
    transition: none;
  }

  .commentBody {
    transition: none;
  }

  .actionBar {
    transition: none;
  }

  .threadLineButton:hover::before {
    transition: none;
  }
}